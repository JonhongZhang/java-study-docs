1. 数据库索引
    如何解题： -----
            Q:  能说说什么是数据库索引？
            A:      索引是帮助数据库高效获得数据的数据结构。索引是在基于数据库表创建的，它包含一个表中的某些列的值以及记录对应的地址，
                并且把这些值存储在一个数据结构中。最常见的就是使用哈希表、B+树作用索引，项目中我们使用InnoDB索引，默认的是B+树。
            Q:  索引的种类有哪些？
            A:  

            Q:  什么情况下适合键索引？
            A:  一般来说，在Where和Join中出现的列需要创建索引，因为MySql只对< , <= , >, >=, Between, IN, 以及某些时候的like才会使用索引（以通配符%和_开头作查询时，mysql不会使用索引）。通用会根据慢查询日志来优化SQL以及判断是否键索引。

            Q:  你们在创建索引的时候都会考虑哪些因素呢？
            A:  在日常工作中，我们会通过开慢查询去记录一些执行时间比较久的SQL的语句，我们公司慢查询阀值是500ms, 找出这些Sql语句后，我们会用到explain命令查看这些sql的执行计划，查看该sql有没有使用上索引，有没有做全表扫描。把查询条件中的没有建立索引的列建立索引。

            Q:  有用过联合索引
            A:  有的

            Q:  在创建联合索引的时候，你是如何考虑多个字段之间的顺序的？
            A:  在创建多列索引时，我们根据业务需求，where子句中使用最频繁的一列，放在最左边，因为mysql索引查询会遵循最左前缀的原则，即最左优先，
                在检索数据时从联合索引的最左边开始匹配。所以当我们创建一个联合索引时，如（key1, key2, key3）, 相当于创建了，（key1）, (key1, key2), (key1, key2, key3）三个索引，这就是最左匹配原则。
            
            Q:  你提到InnoDB使用的B+树的索引模型，那么你知道为什么采用B+树吗？
            A:  由于索引是存在磁盘中的， 当索引非常大的时候，比如达到几个G的时候，无法一次性加入到内存中，所以 数据库中索引使用的是
                查询效率更高的树型结构。B+树是平衡多路查找树，是为磁盘等外部存储设备设计的一种平衡查找树。
                B+树的优点： 系统从磁盘读取数据到内存时以磁盘块（block）为基本单位，位于同一个磁盘的数据会被一次性读取出来，InnoDB引擎中的
                有页（Page） 的概念，页是磁盘管理的最小单位。InnoDB存储引擎中默认设置每页的大小为16kb，可以通过参数innodb_page_size设置页的大小，，InnoDB在把磁盘数据读入到磁盘时会以页的为基本单位，在查询数据时如果一个页中的每条数据都能有助于定位数据记录的位置，这将会减少磁盘I/O
                次数，提高查询效率。
                B+树使用有序数组链表+ 平衡多叉树改良了B树的有序数组+平衡多叉树；
                B+树的关键字全部存放在叶子节点中，非叶子节点用来做索引，而叶子节点中有一个指针指向下一个叶子节点。做这个优化的目的是为了提高区间访问的性能。
                区间访问的例子：
                        数据库中的索引采用B+树的主要原因是B树在提高了磁盘IO性能的同时并没有解决元素遍历效率低下的原因。 正是为了解决这个问题，B+树应用而生。B+树只要遍历叶子节点就可以实现整个树的遍历。而且在数据库中基于范围查询是频繁的，也是B树的优势所在。
                    例子： 要查5-10之间的，B+树一把到5这个标记，在一把到10，然后串起来就行了。而B树在找到第一个符合条件的数字5后，访问完第一个关键字所在的块后，得遍历这个B树，获取下一个块，直到遇到一个不符合条件的关键字。遍历的过程是比较复杂的。
            Q:  B+树与Hash索引比较起来有什么优缺点？
            A:  
            Q:  你知道B+树的叶子节点都可以存哪些东西喃？
            A:  InnoDB的B+树可能存储的是整行数据，也有可能是主键的值，索引B+树的叶子节点存储了整行数据的是主键索引，也被称之为聚簇索引。
                而索引B+树的叶子节点存储了主键的值的是非主键索引，页被称之为非聚簇索引。
            Q:  聚簇索引与非聚簇索引，在查询数据的时候有区别吗？
            A:  主键索引查询只会查一次，而非主键索引需要回表查询多次，通过覆盖索引页可以只查询一次，覆盖索引指一个查询语句只从索引中的能够取得，不必从数据表中读取。
                Mysql只需要通过索引就可以返回查询所需的数据，这样避免了查询到索引后在返回表操作，减少I/O提高效率。
            Q:  mysql索引采用那种数据结构？
            A:  In

            Q:  你提到InnoDB使用的B+树的索引模型，那么你知道为什么采用B+树吗？ 这和hash索引比较起来有啥优缺点？
            A:
            Q:  如果一天几百万的数据，一个月就是几千万，有没有对于查询做一些优化喃？
            A:  


            TINK:
                    1. 了解面试者是否真的做过大数据量检索的项目，如何优化
                    2. 了解面试者对技术的深度的理解程度。



B+树详解：

平衡二叉树： 在二叉树的基础上，两个节点之间相差不能超过1；

减少磁盘IO次数是一种品质，否则老是一进一出的，不好 。
二叉树与平衡二叉树：都是以一个节点放入一个存储块中。

磁盘中读取数据是按照磁盘块读取：尽量将数据放入一个磁盘块中

B+树数据全部存在叶子节点中。

Hash表信息：
    哈希索引适合等值查询，但是无法进行范围查询；哈希索引没办法利用索引完成排序；哈希索引不支持多列联合索引的最左匹配规则；如果有大量重复键值的情况下，哈希索引的效率会很低，可能存在哈希碰撞问题。

聚簇索引与非聚簇索引：
    聚集 索引：以InnoDB作为存储引擎的表，表中数据都会有一个主键，即使你不创建主键，系统也会帮你创建一个隐式的主键。 以主键作为键值构建的B+树索引。
    非聚集索引： 以主键外的列值作为键值构建的B+树索引，为们称为非聚集索引。叶子节点不存储数据，而是存储该列对应的主键，要查找数据，还需要根据主键再聚集索引中查找，这个根据聚集索引查询的过程，被称为伪表。

    数据即索引，索引即数据。
    跟节点一般是在内存中的。

    root@localhost 10:23:  [forum_longtugamev2_db]> explain SELECT * FROM pre_forum_post ORDER BY pid ASC LIMIT 7332000,1000;
+----+-------------+----------------+------+---------------+------+---------+------+---------+----------------+
| id | select_type | table          | type | possible_keys | key  | key_len | ref  | rows    | Extra          |
+----+-------------+----------------+------+---------------+------+---------+------+---------+----------------+
|  1 | SIMPLE      | pre_forum_post | ALL  | NULL          | NULL | NULL    | NULL | 9554664 | Using filesort |
+----+-------------+----------------+------+---------------+------+---------+------+---------+----------------+
1 row in set (0.00 sec)

root@localhost 10:23:  [forum_longtugamev2_db]> explain select a.* from pre_forum_post a ,(select tid,position from pre_forum_post ORDER BY pid ASC LIMIT 7332000,1000) b where a.tid=b.tid and a.position=b.position;
+----+-------------+----------------+--------+-----------------------------------------+---------+---------+------------------+---------+-------------+
| id | select_type | table          | type   | possible_keys                           | key     | key_len | ref              | rows    | Extra       |
+----+-------------+----------------+--------+-----------------------------------------+---------+---------+------------------+---------+-------------+
|  1 | PRIMARY     | <derived2>     | ALL    | NULL                                    | NULL    | NULL    | NULL             |    1000 |             |
|  1 | PRIMARY     | a              | eq_ref | PRIMARY,displayorder,first,idx_position | PRIMARY | 7       | b.tid,b.position |       1 |             |
|  2 | DERIVED     | pre_forum_post | index  | NULL                                    | pid     | 9       | NULL             | 7333000 | Using index |
+----+-------------+----------------+--------+-----------------------------------------+---------+---------+------------------+---------+-------------+
3 rows in set (1.32 sec)